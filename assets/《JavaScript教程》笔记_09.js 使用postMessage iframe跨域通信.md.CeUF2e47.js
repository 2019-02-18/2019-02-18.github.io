import{bV as a,aL as i,u as e,G as t}from"./chunks/framework.DW3NRN-T.js";const c=JSON.parse('{"title":"js 使用postMessage iframe跨域通信","description":"","frontmatter":{"title":"js 使用postMessage iframe跨域通信","date":"2024-03-30T15:21:11.000Z","permalink":"/pages/d67bac/","categories":["《JavaScript教程》笔记"],"tags":[null],"author":{"name":"刘志伟","link":"https://github.com/2019-02-18"},"head":[["meta",{"property":"og:title","content":"js 使用postMessage iframe跨域通信"}],["meta",{"property":"og:description","content":""}],["meta",{"property":"og:url","content":"https://lzw1997.com/《JavaScript教程》笔记/09.js 使用postMessage iframe跨域通信.html"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"property":"article:author","content":"刘志伟"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"js 使用postMessage iframe跨域通信\\",\\"author\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"刘志伟\\"},\\"datePublished\\":\\"2024-03-30T15:21:11.000Z\\",\\"publisher\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"刘志伟\\"},\\"url\\":\\"https://lzw1997.com/《JavaScript教程》笔记/09.js 使用postMessage iframe跨域通信.html\\"}"]]},"headers":[{"level":2,"title":"postMessage 简介","slug":"postmessage-简介","link":"#postmessage-简介","children":[]},{"level":2,"title":"使用 postMessage 进行 iframe 跨域通信","slug":"使用-postmessage-进行-iframe-跨域通信-1","link":"#使用-postmessage-进行-iframe-跨域通信-1","children":[]}],"relativePath":"《JavaScript教程》笔记/09.js 使用postMessage iframe跨域通信.md","filePath":"《JavaScript教程》笔记/09.js 使用postMessage iframe跨域通信.md","lastUpdated":1711784187000}'),n={name:"《JavaScript教程》笔记/09.js 使用postMessage iframe跨域通信.md"};function p(l,s,h,r,k,d){return i(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="使用-postmessage-进行-iframe-跨域通信" tabindex="-1">使用 postMessage 进行 iframe 跨域通信 <a class="header-anchor" href="#使用-postmessage-进行-iframe-跨域通信" aria-label="Permalink to &quot;使用 postMessage 进行 iframe 跨域通信&quot;">​</a></h1><p>在 Web 应用程序中，由于同源策略的限制，如果我们需要在一个页面中嵌入来自不同域的资源（例如图片、脚本或 iframe），那么就会出现跨域问题。在这种情况下，我们需要使用一些技术来实现跨域通信。</p><p>其中一种解决方案是使用 HTML5 中引入的 postMessage API。postMessage 允许我们在不同窗口或 iframe 之间发送消息，这使得我们可以实现跨域通信，而不违反同源策略。</p><h2 id="postmessage-简介" tabindex="-1">postMessage 简介 <a class="header-anchor" href="#postmessage-简介" aria-label="Permalink to &quot;postMessage 简介&quot;">​</a></h2><p>postMessage 是 HTML5 中引入的一种跨窗口通信机制。它允许我们在不同窗口之间发送消息，并且这些窗口可以来自不同的域。postMessage 的基本语法如下：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">otherWindow.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message, targetOrigin, [transfer]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>其中，<code>otherWindow</code> 是目标窗口的引用，<code>message</code> 是要发送的消息，<code>targetOrigin</code> 是目标窗口的源地址，<code>transfer</code> 是一个可选参数，用于传递二进制数据。</p><p>当我们调用 <code>postMessage</code> 方法时，浏览器会将消息异步地传递到目标窗口。当目标窗口接收到消息时，它会触发 <code>message</code> 事件，并将消息作为事件的参数传递给它。我们可以在目标窗口中通过监听 <code>message</code> 事件来接收消息。</p><h2 id="使用-postmessage-进行-iframe-跨域通信-1" tabindex="-1">使用 postMessage 进行 iframe 跨域通信 <a class="header-anchor" href="#使用-postmessage-进行-iframe-跨域通信-1" aria-label="Permalink to &quot;使用 postMessage 进行 iframe 跨域通信&quot;">​</a></h2><p>下面是一个简单的示例，演示如何使用 postMessage 实现 iframe 与父窗口之间的跨域通信。</p><p>首先，我们需要在父窗口中创建一个 iframe 元素，并设置其 src 属性为目标文档的 URL。在这个示例中，我们将目标文档的 URL 设置为 <code>http://example.com/child.html</code>。</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;child-frame&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://example.com/child.html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后，在父窗口中添加以下 JavaScript 代码，以便监听 <code>message</code> 事件：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> childFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;child-frame&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 监听 message 事件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 判断消息来源是否为 childFrame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.source </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> childFrame.contentWindow) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理接收到的消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Received message: &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在子窗口中，我们可以通过调用 <code>parent.postMessage</code> 方法来向父窗口发送消息。例如：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 向父窗口发送消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello, parent window!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在这个例子中，我们向源地址为 <code>http://example.com</code> 的父窗口发送了一条消息。</p><p>当父窗口接收到来自子窗口的消息时，它会触发 <code>message</code> 事件，我们可以在事件处理程序中处理这些消息。</p>`,18)])])}const g=a(n,[["render",p]]);export{c as __pageData,g as default};
